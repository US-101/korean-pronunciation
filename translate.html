<!DOCTYPE html><html lang="zh-Hant"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>實時翻譯</title><link rel="manifest" href="manifest.json"><link rel="stylesheet" href="styles.css">
<link rel="apple-touch-icon" href="icons/icon-512.png"><script>if('serviceWorker' in navigator){addEventListener('load',()=>navigator.serviceWorker.register('./sw.js'));}</script>
</head><body><header class="appbar"><div class="bar"><h1 class="title">實 時 翻 譯</h1></div></header>
<div class="appbar"><div class="row" style="gap:12px;justify-content:center">
  <select id="voiceEn" class="pill" style="appearance:none;padding-right:28px"><option>Daniel</option><option selected>Moira</option><option>Samantha</option><option>Tessa</option></select>
  <span id="mickey" class="pill">🐭</span><span class="pill amber">x0.75</span></div></div>
<main class="wrap"><div class="legend">輸 入 中 文</div><textarea id="in" placeholder="請分開結帳"></textarea><div class="result list" id="result"></div></main><nav class="tabbar"><div class="in"><a class='' href='index.html'><span class='ico'><svg width='22' height='22' viewBox='0 0 24 24' fill='none' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M3 10l9-7 9 7v7a2 2 0 0 1-2 2h-3m-8 0H6a2 2 0 0 1-2-2v-7'/></svg></span>發音練習</a><a class='' href='travel.html'><span class='ico'><svg width='22' height='22' viewBox='0 0 24 24' fill='none' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M6 7V6a3 3 0 0 1 6 0v1m-8 0h14l-1 11a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 7z'/></svg></span>旅行會話</a><a class='active' href='translate.html'><span class='ico'><svg width='22' height='22' viewBox='0 0 24 24' fill='none' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M11 19a8 8 0 1 1 5.3-14.1M21 21l-4.3-4.3'/></svg></span>實時翻譯</a><a class='' href='history.html'><span class='ico'><svg width='22' height='22' viewBox='0 0 24 24' fill='none' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M12 8v5l3 3M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0'/></svg></span>歷史紀錄</a></div></nav>
<script>
const EN=["Daniel","Moira","Samantha","Tessa"];function loadEn(){const all=speechSynthesis.getVoices();const sel=document.getElementById('voiceEn');const picked=EN.map(n=>all.find(v=>v.name===n)).filter(Boolean);if(picked.length){sel.innerHTML=picked.map(v=>`<option>${v.name}</option>`).join("");const saved=localStorage.getItem('voiceEnName');if(saved && picked.some(v=>v.name===saved)) sel.value=saved; sel.addEventListener('change',()=>localStorage.setItem('voiceEnName', sel.value));}}window.speechSynthesis.onvoiceschanged=loadEn;
function speakKO(t){const u=new SpeechSynthesisUtterance(t);u.lang='ko-KR';u.rate=0.75;const v=speechSynthesis.getVoices().find(v=>/ko/i.test(v.lang||''));if(v)u.voice=v;speechSynthesis.speak(u);}function speakEN(t){const sel=document.getElementById('voiceEn');const v=speechSynthesis.getVoices().find(v=>v.name===sel.value)||speechSynthesis.getVoices().find(v=>/en/i.test(v.lang||''));const u=new SpeechSynthesisUtterance(t);if(v)u.voice=v;u.rate=0.75;if(document.getElementById('mickey').classList.contains('on'))u.pitch=1.6;speechSynthesis.speak(u);}document.getElementById('mickey').addEventListener('click',e=>e.target.classList.toggle('on'));
async function tMM(q,from,to){const r=await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(q)}&langpair=${from}|${to}`);const j=await r.json();return j?.responseData?.translatedText||"";}
async function tLibre(q,from,to){const r=await fetch("https://libretranslate.de/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({q,source:from,target:to})});const j=await r.json();return j?.translatedText||"";}
async function doTranslate(text){let ko="",en="";try{en=await tMM(text,"zh-TW","en");}catch(e){}try{ko=await tMM(text,"zh-TW","ko");}catch(e){}if(!en){try{en=await tLibre(text,"zh","en");}catch(e){}}if(!ko){try{ko=await tLibre(text,"zh","ko");}catch(e){}}return {ko,en};}
function hist(){try{return JSON.parse(localStorage.getItem('history')||'[]');}catch(e){return [];}}function saveHist(entry){const h=hist();h.unshift(Object.assign({ts:Date.now()},entry));localStorage.setItem('history',JSON.stringify(h.slice(0,10)));}
function favs(){try{return JSON.parse(localStorage.getItem('favorites')||'[]');}catch(e){return [];}}function saveFav(entry){const f=favs();f.unshift(entry);localStorage.setItem('favorites',JSON.stringify(f));}
const input=document.getElementById('in');const result=document.getElementById('result');let timer=null;input.addEventListener('input',()=>{clearTimeout(timer);const text=input.value.trim();if(!text){result.innerHTML='';return;}timer=setTimeout(async()=>{result.innerHTML="<div class='card'>翻譯中…</div>";const out=await doTranslate(text);const c=document.createElement('div');c.className='card';c.innerHTML=`<div class='ko'>${out.ko||"(韓文失敗)"}</div><div class='en'>${out.en||"(英文失敗)"}</div><div class='zh'>${text}</div><div class='badges'><span class='badge' data-ko='${out.ko}'>韓</span><span class='badge' data-en='${out.en}'>英</span><span class='star' id='fstar'>☆</span></div>`;result.innerHTML='';result.appendChild(c);saveHist({ko:out.ko,en:out.en,zh:text});},400);});
document.addEventListener('click',async (e)=>{if(e.target.matches('[data-ko]'))return speakKO(e.target.getAttribute('data-ko')); if(e.target.matches('[data-en]'))return speakEN(e.target.getAttribute('data-en')); if(e.target.id==='fstar'){const pick=prompt("收藏到哪個資料夾？（旅行/購物/問路/其他）","旅行"); if(!pick)return;const c=e.target.closest('.card'); saveFav({ko:c.querySelector('.ko').textContent,en:c.querySelector('.en').textContent,zh:c.querySelector('.zh').textContent,folder:pick,ts:Date.now()}); e.target.classList.add('on'); e.target.textContent='★';}});
</script></body></html>
