<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>韓文學習｜發音練習</title>
<link rel="stylesheet" href="styles.css" />
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffffff">
<link rel="apple-touch-icon" href="icons/icon-512.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("/sw.js");
    });
  }
</script>

</head>
<body>

<header>
  <div class="wrap">
    <h1>韓文學習｜發音練習</h1>
    <div class="nav">
      <a class="active" href="index.html">發音練習</a>
      <a href="travel.html">旅遊會話</a>
      <a href="translate.html">AI 翻譯</a>
      <a href="favorites.html">★ 收藏</a>
    </div>
    <div class="controls">
      <label>播放速度
        <select id="rate" class="select">
          <option value="0.5">超慢 ×0.5</option>
          <option value="0.75" selected>慢 ×0.75</option>
          <option value="1.0">正常 ×1.0</option>
        </select>
      </label>
      <label class="control"><input type="checkbox" id="repeatTwice" />重複兩次</label>
      <button class="control" id="testVoice">測試韓文（안녕하세요）</button>
    </div>
  </div>
</header>

<main class="wrap">
  <section>
    <div class="legend">子音</div>
    <div class="grid" id="consonants"></div>
  </section>
  <section>
    <div class="legend">母音</div>
    <div class="grid" id="vowels"></div>
  </section>
</main>

<footer>GitHub Pages / Web Speech API（ko-KR）。</footer>

<script>
const data = {
  consonants: [
    {sym:"ㄱ", roman:"g/k", say:"가", words:[["가다","去"],["고기","肉"],["가족","家族"]]},
    {sym:"ㄴ", roman:"n",   say:"나", words:[["나라","國家"],["노래","歌曲"],["눈","眼睛"]]},
    {sym:"ㄷ", roman:"d/t", say:"다", words:[["다리","腿/橋"],["도서관","圖書館"],["달","月亮"]]},
    {sym:"ㄹ", roman:"r/l", say:"라", words:[["라디오","收音機"],["로봇","機器人"],["리본","緞帶"]]},
    {sym:"ㅁ", roman:"m",   say:"마", words:[["머리","頭"],["물","水"],["멀다","遠"]]},
    {sym:"ㅂ", roman:"b/p", say:"바", words:[["바다","海"],["바보","傻瓜"],["빵","麵包"]]},
    {sym:"ㅅ", roman:"s",   say:"사", words:[["사람","人"],["사과","蘋果"],["시간","時間"]]},
    {sym:"ㅇ", roman:"ng/Ø",say:"아", words:[["아이","小孩"],["얼굴","臉"],["운동","運動"]]},
    {sym:"ㅈ", roman:"j",   say:"자", words:[["자다","睡覺"],["지갑","錢包"],["전화","電話"]]},
    {sym:"ㅊ", roman:"ch",  say:"차", words:[["차","車"],["친구","朋友"],["책","書"]]},
    {sym:"ㅋ", roman:"k",   say:"카", words:[["코","鼻子"],["카페","咖啡館"],["쿠키","餅乾"]]},
    {sym:"ㅌ", roman:"t",   say:"타", words:[["토마토","番茄"],["티셔츠","T恤"],["토끼","兔子"]]},
    {sym:"ㅍ", roman:"p",   say:"파", words:[["피자","披薩"],["포도","葡萄"],["편지","信"]]},
    {sym:"ㅎ", roman:"h",   say:"하", words:[["하늘","天空"],["학교","學校"],["하루","一天"]]}
  ],
  vowels: [
    {sym:"ㅏ", roman:"a",  say:"아", words:[["아기","嬰兒"],["바다","海"],["사탕","糖果"]]},
    {sym:"ㅑ", roman:"ya", say:"야", words:[["야구","棒球"],["약","藥"],["양말","襪子"]]},
    {sym:"ㅓ", roman:"eo", say:"어", words:[["서울","首爾"],["버스","公車"],["전화","電話"]]},
    {sym:"ㅕ", roman:"yeo",say:"여", words:[["여자","女人"],["여행","旅行"],["영화","電影"]]},
    {sym:"ㅗ", roman:"o",  say:"오", words:[["오이","小黃瓜"],["손","手"],["도로","道路"]]},
    {sym:"ㅛ", roman:"yo", say:"요", words:[["요리","料理"],["교실","教室"],["표","票"]]},
    {sym:"ㅜ", roman:"u",  say:"우", words:[["우유","牛奶"],["문","門"],["구두","皮鞋"]]},
    {sym:"ㅠ", roman:"yu", say:"유", words:[["유리","玻璃"],["휴지","衛生紙"],["규칙","規則"]]},
    {sym:"ㅡ", roman:"eu", say:"으", words:[["은행","銀行"],["으깨다","壓碎"],["으레","理所當然"]]},
    {sym:"ㅣ", roman:"i",  say:"이", words:[["이름","名字"],["시간","時間"],["비","雨"]]}
  ]
};

function card(item, kind){
  const el = document.createElement('div');
  el.className = 'card';
  el.innerHTML = `
    <div class="hdr">
      <span class="tag">${kind}</span>
      <div class="symbolWrap" data-say="${item.say}">
        <div class="symbol">${item.sym}</div>
        <div class="roman">${item.roman}</div>
      </div>
    </div>
    <div class="chips"></div>
  `;
  const chips = el.querySelector('.chips');
  item.words.forEach(([kr, zh]) => {
    const b = document.createElement('button');
    b.className = 'chip';
    b.setAttribute('data-say', kr);
    b.innerHTML = `<b>${kr}</b> <small>（${zh}）</small>`;
    chips.appendChild(b);
  });
  return el;
}

function render(){
  const c = document.getElementById('consonants');
  const v = document.getElementById('vowels');
  data.consonants.forEach(it => c.appendChild(card(it,'子音')));
  data.vowels.forEach(it => v.appendChild(card(it,'母音')));
}

let voiceKo=null;
function pick(langRegex){
  const list = speechSynthesis.getVoices();
  return list.find(v => langRegex.test((v.lang||""))) || null;
}
function speakKo(t){
  const u = new SpeechSynthesisUtterance(t);
  voiceKo = voiceKo || pick(/ko|korean/i);
  if(voiceKo) u.voice = voiceKo;
  u.lang = 'ko-KR';
  u.rate = parseFloat(document.getElementById('rate').value||'0.75');
  if(document.getElementById('repeatTwice').checked){
    u.onend = ()=>{ const u2=new SpeechSynthesisUtterance(t); if(voiceKo) u2.voice=voiceKo; u2.lang='ko-KR'; u2.rate=u.rate; speechSynthesis.speak(u2); };
  }
  speechSynthesis.speak(u);
}

document.addEventListener('click', (e) => {
  const chip = e.target.closest('.chip');
  if(chip){ speakKo(chip.getAttribute('data-say')); return; }
  const sym = e.target.closest('.symbolWrap');
  if(sym){ speakKo(sym.getAttribute('data-say')); return; }
});
document.getElementById('testVoice').addEventListener('click', ()=>speakKo('안녕하세요'));
window.speechSynthesis.onvoiceschanged = () => { voiceKo = pick(/ko|korean/i); };
document.addEventListener('touchstart', function once(){
  speechSynthesis.speak(new SpeechSynthesisUtterance(''));
  document.removeEventListener('touchstart', once);
},{passive:true});

render();
</script>

</body>
</html>
